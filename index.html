# ğŸ¯ ××—×•×œ×œ ×“×•×—×•×ª × ×™×”×•×œ ×¡×™×›×•× ×™× ××œ× - ×’×¨×¡×” ×¡×•×¤×™×ª
# =====================================================

# ğŸ“¦ ×”×ª×§× ×•×ª ×‘×¡×™×¡×™×•×ª (×¨×§ ××” ×©×“×¨×•×©)
!pip install python-docx PyPDF2 requests

import os
import re
import json
import docx
import PyPDF2
import requests
from google.colab import files
from datetime import datetime

# ğŸ¨ ×ª×‘× ×™×ª HTML ××œ××” ×•×§×‘×•×¢×”
HTML_TEMPLATE = '''<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×•×— × ×™×”×•×œ ×¡×™×›×•× ×™× - {{PROJECT_NAME}}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .editable {
            padding: 3px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .edit-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .pdf-export {
            position: fixed;
            top: 80px;
            left: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .section-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 25px 40px;
            font-size: 2.2em;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }

        .risks-container {
            padding: 40px;
            background: white;
        }

        .risk-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .summary-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .very-high { color: #e74c3c; }
        .high { color: #f39c12; }
        .medium { color: #f1c40f; }
        .low { color: #27ae60; }

        .risks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .risk-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border-top: 6px solid;
        }

        .risk-very-high { border-top-color: #e74c3c; }
        .risk-high { border-top-color: #f39c12; }
        .risk-medium { border-top-color: #f1c40f; }
        .risk-low { border-top-color: #27ae60; }

        .risk-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .risk-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .metric {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }

        .metric-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .risk-description {
            color: #34495e;
            line-height: 1.7;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border-right: 4px solid #bdc3c7;
        }

        .impact-list, .opportunity-list {
            list-style: none;
            padding-right: 15px;
            margin: 10px 0;
        }

        .impact-list li::before {
            content: 'âš ï¸';
            margin-left: 10px;
        }

        .opportunity-list li::before {
            content: 'âœ…';
            margin-left: 10px;
        }

        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="edit-toggle" onclick="toggleEdit()">ğŸ¨ ×”×ª×—×œ ×¢×¨×™×›×”</button>
        <button class="pdf-export" onclick="exportToPDF()">ğŸ“„ ×™×™×¦×•× ×œ-PDF</button>
        
        <header class="header">
            <h1 class="editable">×“×•×— × ×™×”×•×œ ×¡×™×›×•× ×™× ××§×™×£</h1>
            <div class="editable">{{PROJECT_NAME}} - {{PROJECT_DESCRIPTION}}</div>
            <div class="editable">{{ORGANIZATION}} â€¢ 2025</div>
        </header>

        <section class="section">
            <div class="section-header editable">âš ï¸ × ×™×”×•×œ ×¡×™×›×•× ×™×</div>
            
            <div class="risks-container">
                <div class="risk-summary">
                    <div class="summary-card">
                        <div class="summary-number very-high editable">{{RISK_COUNT_VERY_HIGH}}</div>
                        <div class="editable">×¡×™×›×•× ×™× ×‘×—×•××¨×”<br>×’×‘×•×”×” ×××•×“</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number high editable">{{RISK_COUNT_HIGH}}</div>
                        <div class="editable">×¡×™×›×•× ×™× ×‘×—×•××¨×”<br>×’×‘×•×”×”</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number medium editable">{{RISK_COUNT_MEDIUM}}</div>
                        <div class="editable">×¡×™×›×•× ×™× ×‘×—×•××¨×”<br>×‘×™× ×•× ×™×ª</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number low editable">{{RISK_COUNT_LOW}}</div>
                        <div class="editable">×¡×™×›×•× ×™× ×‘×—×•××¨×”<br>× ××•×›×”</div>
                    </div>
                </div>

                <div class="risks-grid">
                    {{RISKS_CARDS}}
                </div>
            </div>
        </section>

        <footer class="footer">
            <p class="editable">Â© 2025 {{ORGANIZATION}}. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</p>
        </footer>
    </div>

    <script>
        const editableElements = document.querySelectorAll('.editable');
        const editToggleButton = document.querySelector('.edit-toggle');
        let isEditing = false;

        function toggleEdit() {
            isEditing = !isEditing;
            editableElements.forEach(el => {
                el.contentEditable = isEditing;
            });
            editToggleButton.textContent = isEditing ? 'ğŸ’¾ ×¡×™×™× ×¢×¨×™×›×”' : 'ğŸ¨ ×”×ª×—×œ ×¢×¨×™×›×”';
        }

        function exportToPDF() {
            window.print();
        }
    </script>
</body>
</html>'''

# ğŸ¤– ×× ×ª×— AI (××¡×¤×¨ ××¤×©×¨×•×™×•×ª)
class AIAnalyzer:
    def __init__(self, api_key=None, model_type="basic"):
        self.api_key = api_key
        self.model_type = model_type
    
    def analyze_risks(self, text):
        """× ×™×ª×•×— ×¡×™×›×•× ×™× ×¢× AI"""
        if self.model_type == "claude" and self.api_key:
            return self._analyze_with_claude(text)
        elif self.model_type == "huggingface":
            return self._analyze_with_huggingface(text)
        else:
            return self._basic_analysis(text)
    
    def _analyze_with_claude(self, text):
        """× ×™×ª×•×— ×¢× Claude API"""
        try:
            headers = {
                'Content-Type': 'application/json',
                'x-api-key': self.api_key,
                'anthropic-version': '2023-06-01'
            }
            
            prompt = f"""
            × ×ª×— ××ª ××¡××š ×”×ª×¤×™×¡×” ×”×‘× ×•×–×”×” 5 ×”×¡×™×›×•× ×™× ×”×¢×™×§×¨×™×™×:

            {text[:3000]}

            ×¢×‘×•×¨ ×›×œ ×¡×™×›×•×Ÿ, ×¡×¤×§:
            1. ×›×•×ª×¨×ª ×§×¦×¨×” (×¢×“ 8 ××™×œ×™×)
            2. ×ª×™××•×¨ ××¤×•×¨×˜ (2-3 ××©×¤×˜×™×)
            3. ×”×¡×ª×‘×¨×•×ª (1-10)
            4. ×¢×•×¦××ª × ×–×§ (1-10)
            5. 3 ×”×©×œ×›×•×ª ××¤×©×¨×™×•×ª
            6. 3 ×”×–×“×× ×•×™×•×ª

            ×”×—×–×¨ ×ª×©×•×‘×” ×‘×¤×•×¨××˜ JSON ×‘×œ×‘×“:
            {{
                "risks": [
                    {{
                        "title": "×›×•×ª×¨×ª ×”×¡×™×›×•×Ÿ",
                        "description": "×ª×™××•×¨ ××¤×•×¨×˜",
                        "probability": 8,
                        "impact": 9,
                        "impacts": ["×”×©×œ×›×” 1", "×”×©×œ×›×” 2", "×”×©×œ×›×” 3"],
                        "opportunities": ["×”×–×“×× ×•×ª 1", "×”×–×“×× ×•×ª 2", "×”×–×“×× ×•×ª 3"]
                    }}
                ]
            }}
            """
            
            data = {
                "model": "claude-3-sonnet-20240229",
                "max_tokens": 2000,
                "messages": [{"role": "user", "content": prompt}]
            }
            
            response = requests.post(
                'https://api.anthropic.com/v1/messages',
                headers=headers,
                json=data,
                timeout=30
            )
            
            if response.status_code == 200:
                result = response.json()
                content = result['content'][0]['text']
                # × ×¡×” ×œ×—×œ×¥ JSON ××”×ª×©×•×‘×”
                json_start = content.find('{')
                json_end = content.rfind('}') + 1
                if json_start != -1 and json_end != -1:
                    json_content = content[json_start:json_end]
                    return json.loads(json_content)
            
        except Exception as e:
            print(f"âš ï¸ ×©×’×™××” ×‘× ×™×ª×•×— Claude: {e}")
        
        # ×× × ×›×©×œ, ×—×–×•×¨ ×œ× ×™×ª×•×— ×‘×¡×™×¡×™
        return self._basic_analysis(text)
    
    def _analyze_with_huggingface(self, text):
        """× ×™×ª×•×— ×¢× Hugging Face (×—×™× ×)"""
        # ×›××Ÿ ××¤×©×¨ ×œ×”×•×¡×™×£ × ×™×ª×•×— ×¢× ××•×“×œ×™× ×—×™× ××™×™×
        return self._basic_analysis(text)
    
    def _basic_analysis(self, text):
        """× ×™×ª×•×— ×‘×¡×™×¡×™ ×¢× ×—×•×§×™×"""
        risk_patterns = [
            {
                "keywords": ["×”×ª× ×’×“×•×ª", "×©×™× ×•×™", "××¨×’×•× ×™"],
                "title": "×”×ª× ×’×“×•×ª ××¨×’×•× ×™×ª ×œ×©×™× ×•×™",
                "description": "×§×™×™× ×¡×™×›×•×Ÿ ×œ×”×ª× ×’×“×•×ª ××¦×“ ×¢×•×‘×“×™× ××• ×× ×”×œ×™× ×œ×ª×”×œ×™×›×™ ×”×©×™× ×•×™ ×”××•×¦×¢×™× ×‘×¤×¨×•×™×§×˜.",
                "probability": 8,
                "impact": 9
            },
            {
                "keywords": ["×ª×§×¦×™×‘", "××—×¡×•×¨", "×¢×œ×•×ª"],
                "title": "××—×¡×•×¨ ×ª×§×¦×™×‘×™",
                "description": "×”×¤×¨×•×™×§×˜ ×¢×œ×•×œ ×œ×”×™×ª×§×œ ×‘××’×‘×œ×•×ª ×ª×§×¦×™×‘×™×•×ª ×©×™×¤×’×¢×• ×‘×™×™×©×•× ×”××œ×.",
                "probability": 7,
                "impact": 8
            },
            {
                "keywords": ["×˜×›× ×•×œ×•×’×™×”", "××•×¨×›×‘×•×ª", "××¢×¨×›×ª"],
                "title": "××•×¨×›×‘×•×ª ×˜×›× ×•×œ×•×’×™×ª",
                "description": "×”×©×™×œ×•×‘ ×©×œ ××¢×¨×›×•×ª ×˜×›× ×•×œ×•×’×™×•×ª ×—×“×©×•×ª ×¢×œ×•×œ ×œ×™×¦×•×¨ ××ª×’×¨×™× ×˜×›× ×™×™× ×œ× ×¦×¤×•×™×™×.",
                "probability": 6,
                "impact": 7
            },
            {
                "keywords": ["×”×›×©×¨×”", "××•×¨×™×", "×›×™×©×•×¨×™×"],
                "title": "×¤×¢×¨×™ ×›×™×©×•×¨×™× ×•×”×›×©×¨×”",
                "description": "×—×•×¡×¨ ×‘×”×›×©×¨×” ××ª××™××” ×¢×œ×•×œ ×œ×¤×’×•×¢ ×‘×™×›×•×œ×ª ×”×¦×•×•×ª×™× ×œ×××© ××ª ×”×¤×¨×•×™×§×˜.",
                "probability": 7,
                "impact": 6
            },
            {
                "keywords": ["×œ×•×—", "×–××Ÿ", "×¢×™×›×•×‘"],
                "title": "×¢×™×›×•×‘×™× ×‘×œ×•×— ×”×–×× ×™×",
                "description": "×”×¤×¨×•×™×§×˜ ×¢×œ×•×œ ×œ×”×ª×¢×›×‘ ×‘×©×œ ×’×•×¨××™× ×—×™×¦×•× ×™×™× ××• ×ª×œ×•×™×•×ª ×‘×™×Ÿ ××©×™××•×ª.",
                "probability": 5,
                "impact": 5
            }
        ]
        
        risks = []
        text_lower = text.lower()
        
        for pattern in risk_patterns:
            if any(keyword in text_lower for keyword in pattern["keywords"]):
                risk = {
                    "title": pattern["title"],
                    "description": pattern["description"],
                    "probability": pattern["probability"],
                    "impact": pattern["impact"],
                    "impacts": [
                        "×¤×’×™×¢×” ×‘×™×¢×“×™ ×”×¤×¨×•×™×§×˜",
                        "×¢×™×›×•×‘×™× ×‘×œ×•×— ×”×–×× ×™×",
                        "×¢×œ×•×™×•×ª × ×•×¡×¤×•×ª ×œ× ×¦×¤×•×™×•×ª"
                    ],
                    "opportunities": [
                        "×¤×™×ª×•×— ×¤×ª×¨×•× ×•×ª ×—×“×©× ×™×™×",
                        "×—×™×–×•×§ ×™×›×•×œ×•×ª ×”×¦×•×•×ª",
                        "×©×™×¤×•×¨ ×ª×”×œ×™×›×™ ×”×¢×‘×•×“×”"
                    ]
                }
                risks.append(risk)
        
        return {"risks": risks[:5]}

# ğŸ”§ ××—×•×œ×œ ×”×“×•×—×•×ª ×”×¨××©×™
class RiskReportGenerator:
    def __init__(self, ai_analyzer=None):
        self.ai_analyzer = ai_analyzer or AIAnalyzer()
        self.template = HTML_TEMPLATE
    
    def extract_text_from_docx(self, file_path):
        """×—×™×œ×•×¥ ×˜×§×¡×˜ ××§×•×‘×¥ Word"""
        try:
            doc = docx.Document(file_path)
            text = []
            for paragraph in doc.paragraphs:
                if paragraph.text.strip():
                    text.append(paragraph.text.strip())
            return '\n'.join(text)
        except Exception as e:
            print(f"âŒ ×©×’×™××” ×‘×§×¨×™××ª ×§×•×‘×¥ Word: {e}")
            return ""
    
    def extract_text_from_pdf(self, file_path):
        """×—×™×œ×•×¥ ×˜×§×¡×˜ ××§×•×‘×¥ PDF"""
        try:
            text = []
            with open(file_path, 'rb') as file:
                pdf_reader = PyPDF2.PdfReader(file)
                for page in pdf_reader.pages:
                    page_text = page.extract_text()
                    if page_text.strip():
                        text.append(page_text.strip())
            return '\n'.join(text)
        except Exception as e:
            print(f"âŒ ×©×’×™××” ×‘×§×¨×™××ª ×§×•×‘×¥ PDF: {e}")
            return ""
    
    def extract_project_info(self, text):
        """×—×™×œ×•×¥ ××™×“×¢ ×‘×¡×™×¡×™ ×¢×œ ×”×¤×¨×•×™×§×˜"""
        lines = text.split('\n')
        
        # ×—×™×¤×•×© ×©× ×¤×¨×•×™×§×˜
        project_name = "×¤×¨×•×™×§×˜ ×—×“×©× ×•×ª ×—×™× ×•×›×™×ª"
        for line in lines[:10]:  # ×‘×“×•×§ 10 ×©×•×¨×•×ª ×¨××©×•× ×•×ª
            if any(word in line.lower() for word in ['×¤×¨×•×™×§×˜', '×¤×™×™×œ×•×˜', '×ª×›× ×™×ª', '×™×•×–××”']):
                if len(line.strip()) > 5:
                    project_name = line.strip()[:50]
                    break
        
        # ×—×™×¤×•×© ××¨×’×•×Ÿ
        organization = "××©×¨×“ ×”×—×™× ×•×š"
        if "××©×¨×“ ×”×—×™× ×•×š" in text:
            organization = "××©×¨×“ ×”×—×™× ×•×š"
        
        # ×ª×™××•×¨
        description = "××•×“×œ ××¨×’×•× ×™-×¤×“×’×•×’×™ ×—×“×©× ×™"
        
        return project_name, organization, description
    
    def format_risks_html(self, risks_data):
        """×¢×™×¦×•×‘ ×”×¡×™×›×•× ×™× ×œ-HTML"""
        if not risks_data or 'risks' not in risks_data:
            return ""
        
        html_parts = []
        severity_classes = {
            'very_high': ('risk-very-high', '×—×•××¨×” ×’×‘×•×”×” ×××•×“'),
            'high': ('risk-high', '×—×•××¨×” ×’×‘×•×”×”'),
            'medium': ('risk-medium', '×—×•××¨×” ×‘×™× ×•× ×™×ª'),
            'low': ('risk-low', '×—×•××¨×” × ××•×›×”')
        }
        
        for risk in risks_data['risks']:
            severity_score = risk['probability'] * risk['impact']
            
            if severity_score >= 70:
                severity_level = 'very_high'
            elif severity_score >= 50:
                severity_level = 'high'
            elif severity_score >= 30:
                severity_level = 'medium'
            else:
                severity_level = 'low'
            
            class_name, severity_text = severity_classes[severity_level]
            
            impacts_html = '\n'.join([f'<li class="editable">{impact}</li>' for impact in risk.get('impacts', [])])
            opportunities_html = '\n'.join([f'<li class="editable">{opp}</li>' for opp in risk.get('opportunities', [])])
            
            risk_html = f'''
            <div class="risk-card {class_name}">
                <div class="risk-title editable">{risk['title']}</div>
                <div class="risk-metrics">
                    <div class="metric">
                        <div class="metric-value editable">{risk['probability']}</div>
                        <div class="metric-label editable">×”×¡×ª×‘×¨×•×ª</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value editable">{risk['impact']}</div>
                        <div class="metric-label editable">×¢×•×¦××ª × ×–×§</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value editable">{severity_score}</div>
                        <div class="metric-label editable">×“×¨×’×ª ×—×•××¨×”</div>
                    </div>
                </div>
                <div class="risk-description editable">{risk['description']}</div>
                <div style="margin-top: 15px;">
                    <strong style="color: #e74c3c;">×”×©×œ×›×•×ª ××¤×©×¨×™×•×ª:</strong>
                    <ul class="impact-list">{impacts_html}</ul>
                </div>
                <div style="margin-top: 15px;">
                    <strong style="color: #27ae60;">×”×–×“×× ×•×™×•×ª:</strong>
                    <ul class="opportunity-list">{opportunities_html}</ul>
                </div>
            </div>
            '''
            html_parts.append(risk_html)
        
        return '\n'.join(html_parts)
    
    def count_risks_by_severity(self, risks_data):
        """×¡×¤×™×¨×ª ×¡×™×›×•× ×™× ×œ×¤×™ ×—×•××¨×”"""
        if not risks_data or 'risks' not in risks_data:
            return {'very_high': 0, 'high': 0, 'medium': 0, 'low': 0}
        
        counts = {'very_high': 0, 'high': 0, 'medium': 0, 'low': 0}
        
        for risk in risks_data['risks']:
            severity_score = risk['probability'] * risk['impact']
            if severity_score >= 70:
                counts['very_high'] += 1
            elif severity_score >= 50:
                counts['high'] += 1
            elif severity_score >= 30:
                counts['medium'] += 1
            else:
                counts['low'] += 1
        
        return counts
    
    def generate_report(self, text):
        """×™×¦×™×¨×ª ×”×“×•×— ×”××œ×"""
        print("ğŸ” ×× ×ª×— ××ª ×”××¡××š...")
        
        # ×—×™×œ×•×¥ ××™×“×¢ ×‘×¡×™×¡×™
        project_name, organization, description = self.extract_project_info(text)
        
        print("ğŸ¤– ××¨×™×¥ × ×™×ª×•×— AI...")
        
        # × ×™×ª×•×— AI
        risks_data = self.ai_analyzer.analyze_risks(text)
        
        print("âš™ï¸ ×‘×•× ×” ××ª ×”×“×•×—...")
        
        # ×¡×¤×™×¨×ª ×¡×™×›×•× ×™×
        risk_counts = self.count_risks_by_severity(risks_data)
        
        # ×‘× ×™×™×ª HTML
        risks_html = self.format_risks_html(risks_data)
        
        # ×”×—×œ×¤×ª ××©×ª× ×™×
        html = self.template.replace('{{PROJECT_NAME}}', project_name)
        html = html.replace('{{ORGANIZATION}}', organization)
        html = html.replace('{{PROJECT_DESCRIPTION}}', description)
        html = html.replace('{{RISKS_CARDS}}', risks_html)
        html = html.replace('{{RISK_COUNT_VERY_HIGH}}', str(risk_counts['very_high']))
        html = html.replace('{{RISK_COUNT_HIGH}}', str(risk_counts['high']))
        html = html.replace('{{RISK_COUNT_MEDIUM}}', str(risk_counts['medium']))
        html = html.replace('{{RISK_COUNT_LOW}}', str(risk_counts['low']))
        
        return html

# ğŸš€ ×¤×•× ×§×¦×™×” ×¨××©×™×ª
def create_risk_report_with_ai():
    """×¤×•× ×§×¦×™×” ×¨××©×™×ª ×œ×™×¦×™×¨×ª ×“×•×— ×¢× AI"""
    print("ğŸ¯ ××—×•×œ×œ ×“×•×—×•×ª × ×™×”×•×œ ×¡×™×›×•× ×™× ×¢× AI")
    print("=====================================")
    
    # ×‘×—×™×¨×ª ×¡×•×’ AI
    print("ğŸ¤– ×‘×—×¨ ×¡×•×’ × ×™×ª×•×— AI:")
    print("1. ×‘×¡×™×¡×™ (×—×™× ×)")
    print("2. Claude Pro (×“×¨×•×© API key)")
    print("3. Hugging Face (×—×™× ×)")
    
    choice = input("×”×›× ×¡ ××¡×¤×¨ (1-3): ").strip()
    
    # ×”×’×“×¨×ª ×× ×ª×— AI
    if choice == "2":
        api_key = input("ğŸ”‘ ×”×›× ×¡ Claude API key: ").strip()
        if api_key:
            analyzer = AIAnalyzer(api_key=api_key, model_type="claude")
            print("âœ… Claude AI ××•×›×Ÿ!")
        else:
            analyzer = AIAnalyzer(model_type="basic")
            print("âš ï¸ ×œ× ×”×•×–×Ÿ API key, ××©×ª××© ×‘× ×™×ª×•×— ×‘×¡×™×¡×™")
    elif choice == "3":
        analyzer = AIAnalyzer(model_type="huggingface")
        print("ğŸ¤— Hugging Face ××•×›×Ÿ!")
    else:
        analyzer = AIAnalyzer(model_type="basic")
        print("ğŸ“Š × ×™×ª×•×— ×‘×¡×™×¡×™ ××•×›×Ÿ!")
    
    # ×”×¢×œ××ª ×§×•×‘×¥
    print("\nğŸ“ ×× × ×”×¢×œ×” ××ª ××¡××š ×”×ª×¤×™×¡×”:")
    uploaded = files.upload()
    
    if not uploaded:
        print("âŒ ×œ× ×”×•×¢×œ×” ×§×•×‘×¥")
        return
    
    filename = list(uploaded.keys())[0]
    print(f"ğŸ“„ ××¢×‘×“ ××ª ×”×§×•×‘×¥: {filename}")
    
    # ×™×¦×™×¨×ª ××—×•×œ×œ ×”×“×•×—×•×ª
    generator = RiskReportGenerator(ai_analyzer=analyzer)
    
    # ×—×™×œ×•×¥ ×˜×§×¡×˜
    if filename.lower().endswith('.docx'):
        text = generator.extract_text_from_docx(filename)
    elif filename.lower().endswith('.pdf'):
        text = generator.extract_text_from_pdf(filename)
    else:
        print("âŒ ×¤×•×¨××˜ ×§×•×‘×¥ ×œ× × ×ª××š. ×× × ×”×¢×œ×” ×§×•×‘×¥ Word ××• PDF")
        return
    
    if not text.strip():
        print("âŒ ×œ× ×”×¦×œ×—×ª×™ ×œ×—×œ×¥ ×˜×§×¡×˜ ××”×§×•×‘×¥")
        return
    
    print(f"âœ… ×—×•×œ×¥ ×˜×§×¡×˜: {len(text)} ×ª×•×•×™×")
    
    # ×™×¦×™×¨×ª ×”×“×•×—
    try:
        html_report = generator.generate_report(text)
        
        # ×©××™×¨×ª ×”×§×•×‘×¥
        output_filename = f"risk_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.html"
        
        with open(output_filename, 'w', encoding='utf-8') as f:
            f.write(html_report)
        
        print(f"âœ… ×”×“×•×— × ×•×¦×¨ ×‘×”×¦×œ×—×”!")
        print(f"ğŸ“Š ×§×•×‘×¥ × ×©××¨ ×‘×©×: {output_filename}")
        
        # ×”×•×¨×“×ª ×”×§×•×‘×¥
        files.download(output_filename)
        
        print("ğŸ‰ ×”×“×•×— ××•×›×Ÿ ×œ×©×™××•×©!")
        
    except Exception as e:
        print(f"âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×”×“×•×—: {e}")

# ğŸ¬ ×”×¤×¢×œ×” ×¨××©×™×ª
if __name__ == "__main__":
    create_risk_report_with_ai()
